{"ast":null,"code":"import _objectSpread from\"/workspace/hoangta/translation-backend/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _regeneratorRuntime from\"/workspace/hoangta/translation-backend/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/workspace/hoangta/translation-backend/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/workspace/hoangta/translation-backend/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import _objectWithoutProperties from\"/workspace/hoangta/translation-backend/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectWithoutProperties\";var _excluded=[\"children\"];/* eslint-disable react/prop-types */import{useHistory}from'react-router-dom';import{useDispatch}from'react-redux';import React,{useEffect,useState}from'react';import{ACCESS_TOKEN}from'../constants/envVar';import*as axiosHelper from'../helpers/axiosHelper';import{changeIsLogin}from'../redux/actions/navbarAction';import{jsx as _jsx}from\"react/jsx-runtime\";var authHoc=function authHoc(WrappedComponent){var FuncComponent=function FuncComponent(_ref){var children=_ref.children,props=_objectWithoutProperties(_ref,_excluded);var _useState=useState(false),_useState2=_slicedToArray(_useState,2),renderCom=_useState2[0],setRenderCom=_useState2[1];var dispatch=useDispatch();var history=useHistory();useEffect(function(){var acc_token=localStorage.getItem(ACCESS_TOKEN);if(!acc_token){history.push('/login');dispatch(changeIsLogin(false));localStorage.clear();return;}var getMe=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var result;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.prev=0;_context.next=3;return axiosHelper.getMe();case 3:result=_context.sent;if(result.data.username){_context.next=9;break;}history.push('/login');dispatch(changeIsLogin(false));localStorage.clear();return _context.abrupt(\"return\");case 9:_context.next=17;break;case 11:_context.prev=11;_context.t0=_context[\"catch\"](0);history.push('/login');dispatch(changeIsLogin(false));localStorage.clear();return _context.abrupt(\"return\");case 17:case\"end\":return _context.stop();}}},_callee,null,[[0,11]]);}));return function getMe(){return _ref2.apply(this,arguments);};}();getMe();setRenderCom(true);},[]);return/*#__PURE__*/_jsx(\"div\",{children:renderCom&&/*#__PURE__*/_jsx(WrappedComponent,_objectSpread(_objectSpread({},props),{},{children:children}))});};return FuncComponent;};export default authHoc;","map":{"version":3,"sources":["/workspace/hoangta/translation-backend/frontend/src/hocs/authHoc.js"],"names":["useHistory","useDispatch","React","useEffect","useState","ACCESS_TOKEN","axiosHelper","changeIsLogin","authHoc","WrappedComponent","FuncComponent","children","props","renderCom","setRenderCom","dispatch","history","acc_token","localStorage","getItem","push","clear","getMe","result","data","username"],"mappings":"y2BAAA,qCACA,OAASA,UAAT,KAA2B,kBAA3B,CACA,OAASC,WAAT,KAA4B,aAA5B,CACA,MAAOC,CAAAA,KAAP,EAAgBC,SAAhB,CAA2BC,QAA3B,KAA2C,OAA3C,CACA,OAASC,YAAT,KAA6B,qBAA7B,CACA,MAAO,GAAKC,CAAAA,WAAZ,KAA6B,wBAA7B,CACA,OAASC,aAAT,KAA8B,+BAA9B,C,2CAEA,GAAMC,CAAAA,OAAO,CAAG,QAAVA,CAAAA,OAAU,CAACC,gBAAD,CAAsB,CACrC,GAAMC,CAAAA,aAAa,CAAG,QAAhBA,CAAAA,aAAgB,MAA4B,IAAzBC,CAAAA,QAAyB,MAAzBA,QAAyB,CAAZC,KAAY,0CACjD,cAAkCR,QAAQ,CAAC,KAAD,CAA1C,wCAAOS,SAAP,eAAkBC,YAAlB,eACA,GAAMC,CAAAA,QAAQ,CAAGd,WAAW,EAA5B,CACA,GAAMe,CAAAA,OAAO,CAAGhB,UAAU,EAA1B,CAKAG,SAAS,CAAC,UAAM,CACf,GAAMc,CAAAA,SAAS,CAAGC,YAAY,CAACC,OAAb,CAAqBd,YAArB,CAAlB,CAEA,GAAI,CAACY,SAAL,CAAgB,CACfD,OAAO,CAACI,IAAR,CAAa,QAAb,EACAL,QAAQ,CAACR,aAAa,CAAC,KAAD,CAAd,CAAR,CACAW,YAAY,CAACG,KAAb,GACA,OACA,CAED,GAAMC,CAAAA,KAAK,2FAAG,oLAGShB,CAAAA,WAAW,CAACgB,KAAZ,EAHT,QAGNC,MAHM,kBAIPA,MAAM,CAACC,IAAP,CAAYC,QAJL,yBAKXT,OAAO,CAACI,IAAR,CAAa,QAAb,EACAL,QAAQ,CAACR,aAAa,CAAC,KAAD,CAAd,CAAR,CACAW,YAAY,CAACG,KAAb,GAPW,yHAaZL,OAAO,CAACI,IAAR,CAAa,QAAb,EACAL,QAAQ,CAACR,aAAa,CAAC,KAAD,CAAd,CAAR,CACAW,YAAY,CAACG,KAAb,GAfY,sGAAH,kBAALC,CAAAA,KAAK,2CAAX,CAoBAA,KAAK,GAELR,YAAY,CAAC,IAAD,CAAZ,CACA,CAjCQ,CAiCN,EAjCM,CAAT,CAmCA,mBAAO,qBACLD,SAAS,eAAI,KAAC,gBAAD,gCAAsBD,KAAtB,eAA8BD,QAA9B,GADR,EAAP,CAGA,CA9CD,CAgDA,MAAOD,CAAAA,aAAP,CACA,CAlDD,CAoDA,cAAeF,CAAAA,OAAf","sourcesContent":["/* eslint-disable react/prop-types */\nimport { useHistory } from 'react-router-dom';\nimport { useDispatch } from 'react-redux';\nimport React, { useEffect, useState } from 'react';\nimport { ACCESS_TOKEN } from '../constants/envVar';\nimport * as axiosHelper from '../helpers/axiosHelper';\nimport { changeIsLogin } from '../redux/actions/navbarAction';\n\nconst authHoc = (WrappedComponent) => {\n\tconst FuncComponent = ({ children, ...props }) => {\n\t\tconst [renderCom, setRenderCom] = useState(false);\n\t\tconst dispatch = useDispatch();\n\t\tconst history = useHistory();\n\n\n\n\n\t\tuseEffect(() => {\n\t\t\tconst acc_token = localStorage.getItem(ACCESS_TOKEN);\n\t\t\n\t\t\tif (!acc_token) {\n\t\t\t\thistory.push('/login');\n\t\t\t\tdispatch(changeIsLogin(false));\n\t\t\t\tlocalStorage.clear();\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst getMe = async () => {\n\n\t\t\t\ttry {\n\t\t\t\t\tconst result = await axiosHelper.getMe();\n\t\t\t\t\tif (!result.data.username) {\n\t\t\t\t\t\thistory.push('/login');\n\t\t\t\t\t\tdispatch(changeIsLogin(false));\n\t\t\t\t\t\tlocalStorage.clear();\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tcatch (e) {\n\t\t\t\t\thistory.push('/login');\n\t\t\t\t\tdispatch(changeIsLogin(false));\n\t\t\t\t\tlocalStorage.clear();\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t};\n\n\t\t\tgetMe();\n\n\t\t\tsetRenderCom(true);\n\t\t}, []);\n\n\t\treturn <div>\n\t\t\t{renderCom && <WrappedComponent {...props}>{children}</WrappedComponent>}\n\t\t</div>;\n\t};\n\n\treturn FuncComponent;\n};\n\nexport default authHoc;\n"]},"metadata":{},"sourceType":"module"}