{"ast":null,"code":"import _regeneratorRuntime from\"/workspace/hoangta/translation-backend/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/workspace/hoangta/translation-backend/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import{TRANSLATEFILE_SUCCESS,TRANSLATEFILE_FAIL,TRANSLATEFILE_DOCUMENT_SUCCESS,TRANSLATEFILE,CHANGE_FILE_DOCUMENT,CHANGE_OUTPUT,CHANGE_OUTPUT_DOCUMENT}from'../constant/translateFileTypes';import*as axiosHelper from'../../helpers/axiosHelper';import{debounce}from'lodash';var STATUS={TRANSLATING:'translating',TRANSLATED:'translated',CONVERTING:'converting',CONVERTED:'converted',CANCELLED:'cancelled'};/**\n * @description Thay đổi giá trị\n */export function changeFileDocument(data){return{type:CHANGE_FILE_DOCUMENT,payload:{file:data}};}/**\n * @description Thay đổi giá trị\n */export function changeOutput(data){return{type:CHANGE_OUTPUT,payload:{data:data}};}export function changeOutputDocument(data){return{type:CHANGE_OUTPUT_DOCUMENT,payload:{data:data}};}export function translationFileLoading(){return{type:TRANSLATEFILE};}/**\n * @description Thành công và trả về kết quả dịch\n */export function translationFileSuccess(data){return{type:TRANSLATEFILE_SUCCESS,payload:{data:data}};}export function translationFileDocumentSuccess(data){return{type:TRANSLATEFILE_DOCUMENT_SUCCESS,payload:{data:data}};}/**\n * @description Thành công và trả về err\n */export function translationFileFailed(err){return{type:TRANSLATEFILE_FAIL,payload:{err:err}};}/**\n * @description Do BE bắt fai kiểm tra status \n * nên sẽ gọi lại API khi nào status được dịch.\n * Đặt thời gian mỗi lần gọi lại API \n * ! => tránh việc gọi liên tục và ko cần thiết\n */var recursiveCheckStatus=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(translationHistoryId,taskId,time){var getTranslationHistoryResult;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.next=2;return axiosHelper.getTranslateHistoryGetSingle({translationHistoryId:translationHistoryId,taskId:taskId});case 2:getTranslationHistoryResult=_context2.sent;if(!(getTranslationHistoryResult.data.status!==STATUS.TRANSLATED)){_context2.next=7;break;}return _context2.abrupt(\"return\",new Promise(function(resolve,reject){setTimeout(/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var _getTranslationHistoryResult;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.prev=0;_context.next=3;return recursiveCheckStatus(translationHistoryId,taskId,time);case 3:_getTranslationHistoryResult=_context.sent;resolve(_getTranslationHistoryResult);_context.next=10;break;case 7:_context.prev=7;_context.t0=_context[\"catch\"](0);reject(_context.t0);case 10:case\"end\":return _context.stop();}}},_callee,null,[[0,7]]);})),1000);}));case 7:return _context2.abrupt(\"return\",getTranslationHistoryResult);case 8:case\"end\":return _context2.stop();}}},_callee2);}));return function recursiveCheckStatus(_x,_x2,_x3){return _ref.apply(this,arguments);};}();/**\n * @description Nhập từ input => đợi 1 khoảng thời gian đẻ nhận text\n * ! Tránh việc gọi API ko cần thiêt và liên tục\n */var debouncedTranslationFile=debounce(/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(body,dispatch){var time,postTranslationResult,getTranslationFileResult,getTranslationResult;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_context3.prev=0;time=1;_context3.next=4;return axiosHelper.translateFile(body);case 4:postTranslationResult=_context3.sent;_context3.next=7;return recursiveCheckStatus(postTranslationResult.data.translationHitoryId,postTranslationResult.data.taskId,time);case 7:getTranslationFileResult=_context3.sent;if(!(getTranslationFileResult.message==='Time Out')){_context3.next=12;break;}dispatch(translationFileFailed(getTranslationFileResult.message));_context3.next=16;break;case 12:_context3.next=14;return axiosHelper.getTranslateResult(getTranslationFileResult.data.resultUrl);case 14:getTranslationResult=_context3.sent;if(getTranslationResult.status==='translated'){dispatch(translationFileDocumentSuccess(getTranslationResult));}else{dispatch(translationFileFailed(getTranslationResult.message));}case 16:_context3.next=21;break;case 18:_context3.prev=18;_context3.t0=_context3[\"catch\"](0);dispatch(translationFileFailed(_context3.t0));case 21:case\"end\":return _context3.stop();}}},_callee3,null,[[0,18]]);}));return function(_x4,_x5){return _ref3.apply(this,arguments);};}(),0);export var translateFileDocumentAsync=function translateFileDocumentAsync(body){return function(dispatch){if(body.get('file')!==null){dispatch(translationFileLoading());debouncedTranslationFile(body,dispatch);}};};","map":{"version":3,"sources":["/workspace/hoangta/translation-backend/frontend/src/redux/actions/translateFileAction.js"],"names":["TRANSLATEFILE_SUCCESS","TRANSLATEFILE_FAIL","TRANSLATEFILE_DOCUMENT_SUCCESS","TRANSLATEFILE","CHANGE_FILE_DOCUMENT","CHANGE_OUTPUT","CHANGE_OUTPUT_DOCUMENT","axiosHelper","debounce","STATUS","TRANSLATING","TRANSLATED","CONVERTING","CONVERTED","CANCELLED","changeFileDocument","data","type","payload","file","changeOutput","changeOutputDocument","translationFileLoading","translationFileSuccess","translationFileDocumentSuccess","translationFileFailed","err","recursiveCheckStatus","translationHistoryId","taskId","time","getTranslateHistoryGetSingle","getTranslationHistoryResult","status","Promise","resolve","reject","setTimeout","debouncedTranslationFile","body","dispatch","translateFile","postTranslationResult","translationHitoryId","getTranslationFileResult","message","getTranslateResult","resultUrl","getTranslationResult","translateFileDocumentAsync","get"],"mappings":"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","sourcesContent":["import {\n\tTRANSLATEFILE_SUCCESS,\n\tTRANSLATEFILE_FAIL,\n\tTRANSLATEFILE_DOCUMENT_SUCCESS,\n\tTRANSLATEFILE,\n\tCHANGE_FILE_DOCUMENT,\n\tCHANGE_OUTPUT,\n\tCHANGE_OUTPUT_DOCUMENT\n} from '../constant/translateFileTypes';\nimport * as axiosHelper from '../../helpers/axiosHelper';\nimport { debounce } from 'lodash';\n\nconst STATUS = {\n\tTRANSLATING: 'translating',\n\tTRANSLATED: 'translated',\n\tCONVERTING: 'converting',\n\tCONVERTED: 'converted',\n\tCANCELLED: 'cancelled',\n};\n\n/**\n * @description Thay đổi giá trị\n */\nexport function changeFileDocument(data) {\n\treturn {\n\t\ttype: CHANGE_FILE_DOCUMENT,\n\t\tpayload: {\n\t\t\tfile: data,\n\t\t}\n\t};\n}\n\n/**\n * @description Thay đổi giá trị\n */\nexport function changeOutput(data) {\n\treturn {\n\t\ttype: CHANGE_OUTPUT,\n\t\tpayload: {\n\t\t\tdata,\n\t\t}\n\t};\n}\n\nexport function changeOutputDocument(data) {\n\treturn {\n\t\ttype: CHANGE_OUTPUT_DOCUMENT,\n\t\tpayload: {\n\t\t\tdata,\n\t\t}\n\t};\n}\n\nexport function translationFileLoading() {\n\treturn {\n\t\ttype: TRANSLATEFILE,\n\t};\n}\n\n/**\n * @description Thành công và trả về kết quả dịch\n */\nexport function translationFileSuccess(data) {\n\treturn {\n\t\ttype: TRANSLATEFILE_SUCCESS,\n\t\tpayload: {\n\t\t\tdata,\n\t\t}\n\t};\n}\n\nexport function translationFileDocumentSuccess(data) {\n\treturn {\n\t\ttype: TRANSLATEFILE_DOCUMENT_SUCCESS,\n\t\tpayload: {\n\t\t\tdata,\n\t\t}\n\t};\n}\n\n/**\n * @description Thành công và trả về err\n */\nexport function translationFileFailed(err) {\n\treturn {\n\t\ttype: TRANSLATEFILE_FAIL,\n\t\tpayload: {\n\t\t\terr,\n\t\t}\n\t};\n}\n\n/**\n * @description Do BE bắt fai kiểm tra status \n * nên sẽ gọi lại API khi nào status được dịch.\n * Đặt thời gian mỗi lần gọi lại API \n * ! => tránh việc gọi liên tục và ko cần thiết\n */\nconst recursiveCheckStatus = async (translationHistoryId, taskId, time) => {\n\tconst getTranslationHistoryResult = await axiosHelper.getTranslateHistoryGetSingle({\n\t\ttranslationHistoryId,\n\t\ttaskId,\n\t});\n\tif (getTranslationHistoryResult.data.status !== STATUS.TRANSLATED) {\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tsetTimeout(async () => {\n\t\t\t\t// 10 * 1000 = 10 sec\n\t\t\t\t// if (time !== 10) {\n\t\t\t\t// time += 1;\n\t\t\t\ttry {\n\t\t\t\t\tconst getTranslationHistoryResult = await recursiveCheckStatus(translationHistoryId, taskId, time);\n\t\t\t\t\tresolve(getTranslationHistoryResult);\n\t\t\t\t} catch (e) {\n\t\t\t\t\treject(e);\n\t\t\t\t}\n\t\t\t\t// } else {\n\t\t\t\t// reject('Time Out');\n\t\t\t\t// }\n\t\t\t}, 1000);\n\t\t});\n\t} else {\n\t\treturn getTranslationHistoryResult;\n\t}\n};\n\n/**\n * @description Nhập từ input => đợi 1 khoảng thời gian đẻ nhận text\n * ! Tránh việc gọi API ko cần thiêt và liên tục\n */\nconst debouncedTranslationFile = debounce(async (body, dispatch) => {\n\ttry {\n\t\tlet time = 1;\n\t\tconst postTranslationResult = await axiosHelper.translateFile(body);\n\t\tconst getTranslationFileResult = await recursiveCheckStatus(\n\t\t\tpostTranslationResult.data.translationHitoryId,\n\t\t\tpostTranslationResult.data.taskId,\n\t\t\ttime\n\t\t);\n\t\tif (getTranslationFileResult.message === 'Time Out') {\n\t\t\tdispatch(translationFileFailed(getTranslationFileResult.message));\n\t\t} else {\n\t\t\tconst getTranslationResult = await axiosHelper.getTranslateResult(getTranslationFileResult.data.resultUrl);\n\t\t\tif (getTranslationResult.status === 'translated') {\n\t\t\t\tdispatch(translationFileDocumentSuccess(getTranslationResult));\n\t\t\t} else {\n\t\t\t\tdispatch(translationFileFailed(getTranslationResult.message));\n\t\t\t}\n\t\t}\n\t} catch (error) {\n\t\tdispatch(translationFileFailed(error));\n\t}\n}, 0);\n\nexport const translateFileDocumentAsync = (body) => (dispatch) => {\n\tif (body.get('file') !== null) {\n\t\tdispatch(translationFileLoading());\n\t\tdebouncedTranslationFile(body, dispatch);\n\t}\n};\n"]},"metadata":{},"sourceType":"module"}