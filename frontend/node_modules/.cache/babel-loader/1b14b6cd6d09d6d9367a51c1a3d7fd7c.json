{"ast":null,"code":"import _regeneratorRuntime from\"/workspace/hoangta/translation-backend/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/workspace/hoangta/translation-backend/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";/* eslint-disable no-unused-vars */import{TRANSLATEFILE_SUCCESS,TRANSLATEFILE_FAIL,TRANSLATEFILE_DOCUMENT_SUCCESS,TRANSLATEFILE,CHANGE_FILE_DOCUMENT,CHANGE_OUTPUT,CHANGE_OUTPUT_DOCUMENT,DETECTLANG_FILE,DETECTLANG_FILE_FAIL,DETECTLANG_FILE_SUCCESS,TRANSLATE_AFTER_DETECTLANG_FILE_SUCCESS}from'../constant/translateFileTypes';import*as axiosHelper from'../../helpers/axiosHelper';import{debounce}from'lodash';import{detectLangFailed,detectLangSuccess,translateAfterDetectLangSuccess}from'./translateAction';var STATUS={TRANSLATING:'translating',TRANSLATED:'translated',CONVERTING:'converting',CONVERTED:'converted',CANCELLED:'cancelled',DETECTING:'detecting'};/**\n * @description Thay đổi giá trị\n */export function changeFileDocument(data){return{type:CHANGE_FILE_DOCUMENT,payload:{file:data}};}/**\n * @description Thay đổi giá trị\n */export function changeOutput(data){return{type:CHANGE_OUTPUT,payload:{data:data}};}export function changeOutputDocument(data){return{type:CHANGE_OUTPUT_DOCUMENT,payload:{data:data}};}export function translationFileLoading(){return{type:TRANSLATEFILE};}/**\n * @description Thành công và trả về kết quả dịch\n */export function translationFileSuccess(data){return{type:TRANSLATEFILE_SUCCESS,payload:{data:data}};}export function translationFileDocumentSuccess(data){return{type:TRANSLATEFILE_DOCUMENT_SUCCESS,payload:{data:data}};}/**\n * @description Thành công và trả về err\n */export function translationFileFailed(err){return{type:TRANSLATEFILE_FAIL,payload:{err:err}};}export function detectLangFile(err){return{type:DETECTLANG_FILE};}export function translateAfterDetectLangFileSuccess(){return{type:TRANSLATE_AFTER_DETECTLANG_FILE_SUCCESS};}export function detectLangFileFailed(err,detectLang){return{type:DETECTLANG_FILE_FAIL,payload:{detectLang:detectLang,err:err}};}export function detectLangFileSuccess(data){return{type:DETECTLANG_FILE_SUCCESS,payload:{detectLang:data.source_lang}};}/**\n * @description Do BE bắt fai kiểm tra status \n * nên sẽ gọi lại API khi nào status được dịch.\n * Đặt thời gian mỗi lần gọi lại API \n * ! => tránh việc gọi liên tục và ko cần thiết\n */var recursiveDetectionCheckStatus=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(translationHistoryId,taskId,time){var getDetectionHistoryResult;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.next=2;return axiosHelper.getDetectionHistoryGetSingle({translationHistoryId:translationHistoryId,taskId:taskId});case 2:getDetectionHistoryResult=_context2.sent;if(!(getDetectionHistoryResult.data.status===STATUS.DETECTING)){_context2.next=7;break;}return _context2.abrupt(\"return\",new Promise(function(resolve,reject){setTimeout(/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var _getDetectionHistoryResult;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.prev=0;_context.next=3;return recursiveDetectionCheckStatus(translationHistoryId,taskId,time);case 3:_getDetectionHistoryResult=_context.sent;resolve(_getDetectionHistoryResult);_context.next=10;break;case 7:_context.prev=7;_context.t0=_context[\"catch\"](0);reject(_context.t0);case 10:case\"end\":return _context.stop();}}},_callee,null,[[0,7]]);})),200);}));case 7:return _context2.abrupt(\"return\",getDetectionHistoryResult);case 8:case\"end\":return _context2.stop();}}},_callee2);}));return function recursiveDetectionCheckStatus(_x,_x2,_x3){return _ref.apply(this,arguments);};}();var recursiveCheckStatus=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee4(translationHistoryId,taskId,time){var getTranslationHistoryResult;return _regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:_context4.next=2;return axiosHelper.getTranslateHistoryGetSingle({translationHistoryId:translationHistoryId,taskId:taskId});case 2:getTranslationHistoryResult=_context4.sent;if(!(getTranslationHistoryResult.data.status!==STATUS.TRANSLATED)){_context4.next=7;break;}return _context4.abrupt(\"return\",new Promise(function(resolve,reject){setTimeout(/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(){var _getTranslationHistoryResult;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_context3.prev=0;_context3.next=3;return recursiveCheckStatus(translationHistoryId,taskId,time);case 3:_getTranslationHistoryResult=_context3.sent;resolve(_getTranslationHistoryResult);_context3.next=10;break;case 7:_context3.prev=7;_context3.t0=_context3[\"catch\"](0);reject(_context3.t0);case 10:case\"end\":return _context3.stop();}}},_callee3,null,[[0,7]]);})),200);}));case 7:return _context4.abrupt(\"return\",getTranslationHistoryResult);case 8:case\"end\":return _context4.stop();}}},_callee4);}));return function recursiveCheckStatus(_x4,_x5,_x6){return _ref3.apply(this,arguments);};}();/**\n * @description Nhập từ input => đợi 1 khoảng thời gian đẻ nhận text\n * ! Tránh việc gọi API ko cần thiêt và liên tục\n */var debouncedTranslationFile=debounce(/*#__PURE__*/function(){var _ref5=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee5(body,dispatch){var time,postTranslationResult,getTranslationFileResult,getTranslationResult;return _regeneratorRuntime.wrap(function _callee5$(_context5){while(1){switch(_context5.prev=_context5.next){case 0:_context5.prev=0;time=1;_context5.next=4;return axiosHelper.translateFile(body);case 4:postTranslationResult=_context5.sent;_context5.next=7;return recursiveCheckStatus(postTranslationResult.data.translationHitoryId,postTranslationResult.data.taskId,time);case 7:getTranslationFileResult=_context5.sent;if(!(getTranslationFileResult.message==='Time Out')){_context5.next=12;break;}dispatch(translationFileFailed(getTranslationFileResult.message));_context5.next=16;break;case 12:_context5.next=14;return axiosHelper.getTranslateResult(getTranslationFileResult.data.resultUrl);case 14:getTranslationResult=_context5.sent;if(getTranslationResult.status==='translated'){dispatch(translationFileDocumentSuccess(getTranslationResult));}else{dispatch(translationFileFailed(getTranslationResult.message));}case 16:_context5.next=21;break;case 18:_context5.prev=18;_context5.t0=_context5[\"catch\"](0);dispatch(translationFileFailed(_context5.t0));case 21:case\"end\":return _context5.stop();}}},_callee5,null,[[0,18]]);}));return function(_x7,_x8){return _ref5.apply(this,arguments);};}(),0);var debouncedTranslateAndDetectFile=debounce(/*#__PURE__*/function(){var _ref6=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee6(body,dispatch){var time,formData,getDetectLangInstant,getSourceLang,getDetectResult,postTranslationResult,getTranslationHistoryResult,getTranslationResult;return _regeneratorRuntime.wrap(function _callee6$(_context6){while(1){switch(_context6.prev=_context6.next){case 0:_context6.prev=0;time=1;// Phát hiện ngôn ngữ\nformData=new FormData();formData.append('file',body.sourceFile);_context6.next=6;return axiosHelper.detectLangFile(formData);case 6:getDetectLangInstant=_context6.sent;_context6.next=9;return recursiveDetectionCheckStatus(getDetectLangInstant.data.translationHitoryId,getDetectLangInstant.data.taskId,time);case 9:getSourceLang=_context6.sent;if(!(getSourceLang.message==='Time Out')){_context6.next=15;break;}dispatch(detectLangFileFailed(getSourceLang.message,'unknown'));dispatch(detectLangFailed(getSourceLang.message,'unknown'));_context6.next=42;break;case 15:_context6.next=17;return axiosHelper.getTranslateResult(getSourceLang.data.resultUrl);case 17:getDetectResult=_context6.sent;if(!(getDetectResult.status==='closed')){_context6.next=23;break;}dispatch(detectLangFileFailed(getDetectResult.message,getDetectResult.source_lang));dispatch(detectLangFailed(getDetectResult.message,getDetectResult.source_lang));_context6.next=42;break;case 23:// Sử dụng ngôn ngữ phát hiện được và dịch\ndispatch(detectLangFileSuccess({source_lang:getDetectResult.source_lang}));dispatch(detectLangSuccess({source_lang:getDetectResult.source_lang}));formData.append('sourceLang',getDetectResult.source_lang);formData.append('targetLang',body.targetLang);_context6.next=29;return axiosHelper.translateFile(formData);case 29:postTranslationResult=_context6.sent;_context6.next=32;return recursiveCheckStatus(postTranslationResult.data.translationHitoryId,postTranslationResult.data.taskId,time);case 32:getTranslationHistoryResult=_context6.sent;if(!(getTranslationHistoryResult.message==='Time Out')){_context6.next=38;break;}dispatch(detectLangFileFailed(getTranslationHistoryResult.message,'unknown'));dispatch(detectLangFailed(getTranslationHistoryResult.message,'unknown'));_context6.next=42;break;case 38:_context6.next=40;return axiosHelper.getTranslateResult(getTranslationHistoryResult.data.resultUrl);case 40:getTranslationResult=_context6.sent;if(getTranslationResult.status==='closed'){dispatch(detectLangFileFailed(getTranslationResult.message,getTranslationResult.source_lang));dispatch(detectLangFailed(getTranslationResult.message,getTranslationResult.source_lang));}else{dispatch(translationFileDocumentSuccess(getTranslationResult));dispatch(translateAfterDetectLangFileSuccess());dispatch(translateAfterDetectLangSuccess(getTranslationResult));}case 42:_context6.next=47;break;case 44:_context6.prev=44;_context6.t0=_context6[\"catch\"](0);dispatch(detectLangFileFailed(_context6.t0,'unknown'));case 47:case\"end\":return _context6.stop();}}},_callee6,null,[[0,44]]);}));return function(_x9,_x10){return _ref6.apply(this,arguments);};}(),0);export var translateFileDocumentAsync=function translateFileDocumentAsync(body){return function(dispatch){if(body.get('file')!==null){dispatch(translationFileLoading());debouncedTranslationFile(body,dispatch);}};};export var translationAndDetectFileAsync=function translationAndDetectFileAsync(body){return function(dispatch){dispatch(detectLangFile());debouncedTranslateAndDetectFile(body,dispatch);};};","map":{"version":3,"sources":["/workspace/hoangta/translation-backend/frontend/src/redux/actions/translateFileAction.js"],"names":["TRANSLATEFILE_SUCCESS","TRANSLATEFILE_FAIL","TRANSLATEFILE_DOCUMENT_SUCCESS","TRANSLATEFILE","CHANGE_FILE_DOCUMENT","CHANGE_OUTPUT","CHANGE_OUTPUT_DOCUMENT","DETECTLANG_FILE","DETECTLANG_FILE_FAIL","DETECTLANG_FILE_SUCCESS","TRANSLATE_AFTER_DETECTLANG_FILE_SUCCESS","axiosHelper","debounce","detectLangFailed","detectLangSuccess","translateAfterDetectLangSuccess","STATUS","TRANSLATING","TRANSLATED","CONVERTING","CONVERTED","CANCELLED","DETECTING","changeFileDocument","data","type","payload","file","changeOutput","changeOutputDocument","translationFileLoading","translationFileSuccess","translationFileDocumentSuccess","translationFileFailed","err","detectLangFile","translateAfterDetectLangFileSuccess","detectLangFileFailed","detectLang","detectLangFileSuccess","source_lang","recursiveDetectionCheckStatus","translationHistoryId","taskId","time","getDetectionHistoryGetSingle","getDetectionHistoryResult","status","Promise","resolve","reject","setTimeout","recursiveCheckStatus","getTranslateHistoryGetSingle","getTranslationHistoryResult","debouncedTranslationFile","body","dispatch","translateFile","postTranslationResult","translationHitoryId","getTranslationFileResult","message","getTranslateResult","resultUrl","getTranslationResult","debouncedTranslateAndDetectFile","formData","FormData","append","sourceFile","getDetectLangInstant","getSourceLang","getDetectResult","targetLang","translateFileDocumentAsync","get","translationAndDetectFileAsync"],"mappings":"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","sourcesContent":["/* eslint-disable no-unused-vars */\nimport {\n\tTRANSLATEFILE_SUCCESS,\n\tTRANSLATEFILE_FAIL,\n\tTRANSLATEFILE_DOCUMENT_SUCCESS,\n\tTRANSLATEFILE,\n\tCHANGE_FILE_DOCUMENT,\n\tCHANGE_OUTPUT,\n\tCHANGE_OUTPUT_DOCUMENT,\n\tDETECTLANG_FILE,\n\tDETECTLANG_FILE_FAIL,\n\tDETECTLANG_FILE_SUCCESS,\n\tTRANSLATE_AFTER_DETECTLANG_FILE_SUCCESS\n} from '../constant/translateFileTypes';\nimport * as axiosHelper from '../../helpers/axiosHelper';\nimport { debounce } from 'lodash';\nimport { detectLangFailed, detectLangSuccess, translateAfterDetectLangSuccess } from './translateAction';\n\nconst STATUS = {\n\tTRANSLATING: 'translating',\n\tTRANSLATED: 'translated',\n\tCONVERTING: 'converting',\n\tCONVERTED: 'converted',\n\tCANCELLED: 'cancelled',\n\tDETECTING: 'detecting'\n};\n\n/**\n * @description Thay đổi giá trị\n */\nexport function changeFileDocument(data) {\n\treturn {\n\t\ttype: CHANGE_FILE_DOCUMENT,\n\t\tpayload: {\n\t\t\tfile: data,\n\t\t}\n\t};\n}\n\n/**\n * @description Thay đổi giá trị\n */\nexport function changeOutput(data) {\n\treturn {\n\t\ttype: CHANGE_OUTPUT,\n\t\tpayload: {\n\t\t\tdata,\n\t\t}\n\t};\n}\n\nexport function changeOutputDocument(data) {\n\treturn {\n\t\ttype: CHANGE_OUTPUT_DOCUMENT,\n\t\tpayload: {\n\t\t\tdata,\n\t\t}\n\t};\n}\n\nexport function translationFileLoading() {\n\treturn {\n\t\ttype: TRANSLATEFILE,\n\t};\n}\n\n/**\n * @description Thành công và trả về kết quả dịch\n */\nexport function translationFileSuccess(data) {\n\treturn {\n\t\ttype: TRANSLATEFILE_SUCCESS,\n\t\tpayload: {\n\t\t\tdata,\n\t\t}\n\t};\n}\n\nexport function translationFileDocumentSuccess(data) {\n\treturn {\n\t\ttype: TRANSLATEFILE_DOCUMENT_SUCCESS,\n\t\tpayload: {\n\t\t\tdata,\n\t\t}\n\t};\n}\n\n/**\n * @description Thành công và trả về err\n */\nexport function translationFileFailed(err) {\n\treturn {\n\t\ttype: TRANSLATEFILE_FAIL,\n\t\tpayload: {\n\t\t\terr,\n\t\t}\n\t};\n}\n\nexport function detectLangFile(err) {\n\treturn {\n\t\ttype: DETECTLANG_FILE\n\t};\n}\nexport function translateAfterDetectLangFileSuccess() {\n\treturn {\n\t\ttype: TRANSLATE_AFTER_DETECTLANG_FILE_SUCCESS\n\t};\n}\n\nexport function detectLangFileFailed(err, detectLang) {\n\treturn {\n\t  type: DETECTLANG_FILE_FAIL,\n\t  payload: {\n\t\t\tdetectLang,\n\t\t\terr,\n\t\t}\n\t};\n}\n\nexport function detectLangFileSuccess(data) {\n\treturn {\n\t  type: DETECTLANG_FILE_SUCCESS,\n\t  payload: {\n\t\t\tdetectLang: data.source_lang,\n\t\t}\n\t};\n}\n\n\n\n/**\n * @description Do BE bắt fai kiểm tra status \n * nên sẽ gọi lại API khi nào status được dịch.\n * Đặt thời gian mỗi lần gọi lại API \n * ! => tránh việc gọi liên tục và ko cần thiết\n */\nconst recursiveDetectionCheckStatus = async (translationHistoryId, taskId, time) => {\n\tconst getDetectionHistoryResult = await axiosHelper.getDetectionHistoryGetSingle({\n\t\ttranslationHistoryId,\n\t\ttaskId,\n\t});\n\n\tif (getDetectionHistoryResult.data.status === STATUS.DETECTING) {\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tsetTimeout(async () => {\n\t\t\t\ttry {\n\t\t\t\t\tconst getDetectionHistoryResult = await recursiveDetectionCheckStatus(translationHistoryId, taskId, time);\n\t\t\t\t\tresolve(getDetectionHistoryResult);\n\t\t\t\t} catch (e) {\n\t\t\t\t\treject(e);\n\t\t\t\t}\n\t\t\t}, 200);\n\t\t});\n\t} else {\n\t\treturn getDetectionHistoryResult;\n\t}\n};\n\nconst recursiveCheckStatus = async (translationHistoryId, taskId, time) => {\n\tconst getTranslationHistoryResult = await axiosHelper.getTranslateHistoryGetSingle({\n\t\ttranslationHistoryId,\n\t\ttaskId,\n\t});\n\tif (getTranslationHistoryResult.data.status !== STATUS.TRANSLATED) {\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tsetTimeout(async () => {\n\t\t\t\t// 10 * 1000 = 10 sec\n\t\t\t\t// if (time !== 10) {\n\t\t\t\t// time += 1;\n\t\t\t\ttry {\n\t\t\t\t\tconst getTranslationHistoryResult = await recursiveCheckStatus(translationHistoryId, taskId, time);\n\t\t\t\t\tresolve(getTranslationHistoryResult);\n\t\t\t\t} catch (e) {\n\t\t\t\t\treject(e);\n\t\t\t\t}\n\t\t\t\t// } else {\n\t\t\t\t// reject('Time Out');\n\t\t\t\t// }\n\t\t\t}, 200);\n\t\t});\n\t} else {\n\t\treturn getTranslationHistoryResult;\n\t}\n};\n\n/**\n * @description Nhập từ input => đợi 1 khoảng thời gian đẻ nhận text\n * ! Tránh việc gọi API ko cần thiêt và liên tục\n */\nconst debouncedTranslationFile = debounce(async (body, dispatch) => {\n\ttry {\n\t\tlet time = 1;\n\t\tconst postTranslationResult = await axiosHelper.translateFile(body);\n\t\tconst getTranslationFileResult = await recursiveCheckStatus(\n\t\t\tpostTranslationResult.data.translationHitoryId,\n\t\t\tpostTranslationResult.data.taskId,\n\t\t\ttime\n\t\t);\n\t\tif (getTranslationFileResult.message === 'Time Out') {\n\t\t\tdispatch(translationFileFailed(getTranslationFileResult.message));\n\t\t} else {\n\t\t\tconst getTranslationResult = await axiosHelper.getTranslateResult(getTranslationFileResult.data.resultUrl);\n\t\t\tif (getTranslationResult.status === 'translated') {\n\t\t\t\tdispatch(translationFileDocumentSuccess(getTranslationResult));\n\t\t\t} else {\n\t\t\t\tdispatch(translationFileFailed(getTranslationResult.message));\n\t\t\t}\n\t\t}\n\t} catch (error) {\n\t\tdispatch(translationFileFailed(error));\n\t}\n}, 0);\n\nconst debouncedTranslateAndDetectFile = debounce(async (body, dispatch) => {\n\ttry {\n\t\tlet time = 1;\n\t\t// Phát hiện ngôn ngữ\n\t\tconst formData = new FormData();\n\t\tformData.append('file', body.sourceFile);\n\t\tconst getDetectLangInstant = await axiosHelper.detectLangFile(formData);\n\t\tconst getSourceLang = await recursiveDetectionCheckStatus(\n\t\t\tgetDetectLangInstant.data.translationHitoryId, \n\t\t\tgetDetectLangInstant.data.taskId, \n\t\t\ttime\n\t\t); \n\t\n\t\tif(getSourceLang.message === 'Time Out'){\n\t\t\tdispatch(detectLangFileFailed(getSourceLang.message, 'unknown'));\n\t\t\tdispatch(detectLangFailed(getSourceLang.message, 'unknown'));\n\t\t} else {\n\t\t\tconst getDetectResult = await axiosHelper.getTranslateResult(getSourceLang.data.resultUrl);\n\t\t\tif (getDetectResult.status === 'closed'){\n\t\t\t\tdispatch(detectLangFileFailed(getDetectResult.message, getDetectResult.source_lang));\n\t\t\t\tdispatch(detectLangFailed(getDetectResult.message, getDetectResult.source_lang));\n\t\t\t} else {\n\t\t\t\t// Sử dụng ngôn ngữ phát hiện được và dịch\n\t\t\t\tdispatch(detectLangFileSuccess({source_lang: getDetectResult.source_lang}));\n\t\t\t\tdispatch(detectLangSuccess({source_lang: getDetectResult.source_lang}));\n\t\t\t\tformData.append('sourceLang', getDetectResult.source_lang);\n\t\t\t\tformData.append('targetLang', body.targetLang);\n\n\t\t\t\tconst postTranslationResult = await axiosHelper.translateFile(formData);\n\n\t\t\t\tconst getTranslationHistoryResult = await recursiveCheckStatus(\n\t\t\t\t\tpostTranslationResult.data.translationHitoryId, \n\t\t\t\t\tpostTranslationResult.data.taskId, \n\t\t\t\t\ttime\n\t\t\t\t);\n\t\t\t\tif(getTranslationHistoryResult.message === 'Time Out'){\n\t\t\t\t\tdispatch(detectLangFileFailed(getTranslationHistoryResult.message, 'unknown'));\n\t\t\t\t\tdispatch(detectLangFailed(getTranslationHistoryResult.message, 'unknown'));\n\t\t\t\t} else {\n\t\t\t\t\tconst getTranslationResult = await axiosHelper.getTranslateResult(getTranslationHistoryResult.data.resultUrl);\n\t\t\t\t\tif (getTranslationResult.status === 'closed'){\n\t\t\t\t\t\tdispatch(detectLangFileFailed(getTranslationResult.message, getTranslationResult.source_lang));\n\t\t\t\t\t\tdispatch(detectLangFailed(getTranslationResult.message, getTranslationResult.source_lang));\n\t\t\t\t\t} else {\n\t\t\t\t\t\tdispatch(translationFileDocumentSuccess(getTranslationResult));\n\t\t\t\t\t\tdispatch(translateAfterDetectLangFileSuccess());\n\t\t\t\t\t\tdispatch(translateAfterDetectLangSuccess(getTranslationResult));\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t} catch(error) {\n\t\tdispatch(detectLangFileFailed(error, 'unknown'));\n\t}\n}, 0);\n\nexport const translateFileDocumentAsync = (body) => (dispatch) => {\n\tif (body.get('file') !== null) {\n\t\tdispatch(translationFileLoading());\n\t\tdebouncedTranslationFile(body, dispatch);\n\t}\n};\n\nexport const translationAndDetectFileAsync = (body) => (dispatch) => {\n\tdispatch(detectLangFile());\n\tdebouncedTranslateAndDetectFile(body, dispatch);\n};\n"]},"metadata":{},"sourceType":"module"}